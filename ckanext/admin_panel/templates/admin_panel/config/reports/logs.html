{% extends 'admin_panel/base.html' %}

{% import 'macros/autoform.html' as autoform %}
{% import 'macros/form.html' as form %}
{% import 'admin_panel/macros/form.html' as ap_form %}

{% block ap_main_class %} ap-log-list {% endblock %}

{% block breadcrumb_content %}
    <li>{% link_for _("Recent log messages"), named_route='ap_report.logs' %}</li>
{% endblock breadcrumb_content %}

{% block ap_content %}
    <h1>{{ _("Recent log messages") }}</h1>

    <div class="row g-3">
        <form action="{{ h.url_for('ap_report.logs') }}" method="GET" id="ap-logs-filter" class="ap-table-filter">
            <div class="form-field">
                <div class="search-input-wrapper">
                    {% call form.input("q", label=_("Search"), value=q, placeholder=_('Search')) %}
                        <button class="btn-search" type="submit"><i class="fa fa-search"></i></button>
                    {% endcall %}
                </div>
            </div>

            <div class="form-field">
                {{ ap_form.multi_select('type', label=_("Type"), options=h.ap_log_list_type_options(), selected=types, error='') }}
            </div>

            <div class="form-field">
                {{ ap_form.multi_select('level', label=_("Level"), options=h.ap_log_list_level_options(), selected=levels, error='') }}
            </div>

            <div class="form-field">
                <div class="form-group">
                    <label class="form-label" for="start_time">
                        {{ _("Start date") }}
                    </label>
                    <div class="controls">
                        <input
                            class="form-control"
                            type="datetime-local"
                            id="start_time"
                            name="start_time"
                            value="{{ start_time }}"
                        />
                    </div>
                </div>
            </div>

            <div class="form-field">
                <div class="form-group">
                    <label class="form-label" for="end_time">
                        {{ _("End date") }}
                    </label>
                    <div class="controls">
                        <input
                            class="form-control"
                            type="datetime-local"
                            id="end_time"
                            name="end_time"
                            value="{{ end_time }}"
                        />
                    </div>
                </div>
            </div>

            <div class="form-buttons">
                <button type="submit" class="btn btn-primary">{{ _("Filter") }}</button>
                <a href="{{ h.url_for('ap_report.logs') }}" class="btn btn-primary">{{ _("Clear") }}</a>
            </div>

            {{ form.hidden("sort", sort) }}
            {{ form.hidden("order_by", order_by) }}
        </form>

        <form action="{{ h.url_for('ap_report.logs') }}" method="POST">
            <button
                id="clear-logs-btn"
                name="clear_logs"
                type="submit"
                class="btn btn-danger"
                data-module="confirm-action"
                data-module-content="{{ _('Are you sure you want to clear all logs?') }}"
                data-module-with-data=true>
                {{ _("Clear logs") }}
            </button>
        </form>
        {% snippet "admin_panel/config/snippets/sortable_table.html", items=item_list, columns=columns, empty_msg=_("No log messages available"), order_by=order_by, sort=sort %}
    </div> <!-- row -->
{% endblock ap_content %}


{% block page_pagination %}
    <div class="ap-pager">
        {% if has_prev %}
            {% set first_item_id = item_list[0].id if item_list else "" %}
            <a href="{{ h.url_for('ap_report.logs', first_item_id=first_item_id, type=types, level=levels, order_by=order_by, sort=sort, start_time=start_time, end_time=end_time) }}" class="prev-page" title="prev page">
                {% snippet 'snippets/svg/arrow-left.svg' %}
            </a>
        {% else %}
            <span class="prev-page disabled">
                {% snippet 'snippets/svg/arrow-left.svg' %}
            </span>
        {% endif %}

        <span class="current-page">{{ current_page }}</span>

        {% if has_next %}
            {% set last_item_id = item_list[-1].id if item_list else "" %}
            <a href="{{ h.url_for('ap_report.logs', last_item_id=last_item_id, type=types, level=levels, order_by=order_by, sort=sort, start_time=start_time, end_time=end_time) }}" class="next-page" title="next page">
                {% snippet 'snippets/svg/arrow-left.svg' %}
            </a>
        {% endif %}
    </div>
{% endblock %}
