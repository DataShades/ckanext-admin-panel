{#
Creates a markup for a sortable table

name        - The name of table.
items       - List of the items to show
columns     - List of table columns and their configurations
    column attrs:
        name        - column machine name. The item from items must have this attr
        label       - column Label
        type        - type of column - one of: date
        sortable    - enable sorting by column
bulk_check - Add bulk check column
empty_msg       - Message to show if the items is empty (default: No items found for this query).
order_by        - Order by
sort            - Sort by

Examples:

{% import 'admin_panel/macros/sortable_table.html' as macro %}
{{ macro.sortable_table('title') }}

#}
{% from "macros/form/attributes.html" import attributes %}

{% if items %}
<table class="table table-light table-primary table-striped table-scrollable table-sortable table-{{ name }}">
    <colgroup>
        {% if bulk_check %}
            <col span="1" style="width: 2%;">
        {% endif %}

        {% for col in columns %}
            <col span="1" style="width: {{ col.width or 'fit-content' }};">
        {% endfor %}
    </colgroup>

    <tbody>
        <tr>
            {% if bulk_check %}
                <th class="checkbox-cell checkbox-cell-bulk">
                    <input type="checkbox" name="bulk_check" id="bulk_check" data-module="ap-bulk-check">
                </th>
            {% endif %}

            {% for col in columns %}
                {% set sort_active = order_by == col.name %}
                {% set url = h.ap_add_url_param('order_by', col.name) if not sort_active else h.ap_add_url_param('sort', "asc" if sort == "desc" else "desc") %}

                {% if col.sortable %}
                    <th class="th-sortable {% if sort_active %}th-active{% endif %}">
                        <a href="{{ url }}">
                            {{ col.label }}
                            <span class="table-sort {% if sort_active %}table-sort--{{ sort }}{% endif %}"></span>
                        </a>
                    </th>
                {% else %}
                    <th>{{ col.label }}</th>
                {% endif %}
            {% endfor %}
        </tr>
        {% for item in items %}
            <tr>
                {% if bulk_check %}
                    {% if name == "content-list" %}
                        {% snippet "admin_panel/config/snippets/bulk_column_user.html", item=item %}
                    {% else %}
                        <td class="checkbox-cell checkbox-cell-row">
                            <input type="checkbox" name="entity_id" id="entity_id" value="{{ item.id }}">
                        </td>
                    {% endif %}
                {% endif %}

                {% for col in columns %}
                    <td>
                        {% if col.column_renderer.__name__ != "action_render" %}
                            {{ col.column_renderer(items, item, item[col.name], **col.renderer_kwargs) }}
                        {% else %}
                            {% for action in col.actions %}
                                {% set params = {} %}

                                {% for k, v in action.params.items() %}
                                    {% if v[0] == "$" %}
                                        {% do params.update({k: item[v[1:]]}) %}
                                    {% else %}
                                        {% do params.update({k: v}) %}
                                    {% endif %}
                                {% endfor %}

                                {% if "class" not in action.attributes %}
                                    {% do action.attributes.update(class="btn btn-primary") %}
                                {% endif %}

                                <a href="{{  h.url_for(action.endpoint, **params) }}" {{ attributes(action.attributes) }}>
                                    {{ action.label or "" }}
                                    {% if action.icon %}
                                        <i class="{{ action.icon }}"></i>
                                    {% endif %}
                                </a>
                            {% endfor %}
                        {% endif %}
                    </td>
                {% endfor %}
            </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
    <p>{{ empty_msg or _("No items found for this query.") }} <a href="{{ request.url_rule }}">{{ _("Clear?") }}</a></p>
{% endif %}
